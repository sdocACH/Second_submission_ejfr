\section{Materials and Methods}
\label{sec:MatMeth}

% ----------------------------------------------------------------------- %
% ----------------------------------------------------------------------- %
\subsection{Study Area}
\label{sec:studyarea}

The German federal state Rhineland-Palatinate (RLP) is located in the western part of Germany and borders Luxembourg, France and Belgium (figure \ref{fig:Study Area}). With 42.3\% (appr. 8400 km$^2$) of the entire state area (19850 km$^2$) covered by forest, RLP is one of the two states with the highest forest coverage among all federal states of Germany \citep{bwi3}. The most frequent tree species in RLP are European beech (\textit{fagus sylvatica}, 21.8\%), oak (\textit{quercus petrea} and \textit{quercus robur}, 20.2\%), Norway spruce (\textit{picea abies}, 19.5\%), Scots pine (\textit{pinus sylvestris}, 9.9\%), Douglas fir (\textit{pseudozuga menziesii}, 6.4\%), European larch (\textit{larix decidua}, 2.4\%) and Silver fir (\textit{abies alba}, 0.7\%). The share of broadleaf tree species is 58.7\%. The forests of RLP further exhibit heterogeneous structures \citep{bwi3}: around 82\% of the forest area in RLP are mixed forest stands (i.e. at least two different tree species occur in the same stand) and 69\% of the forest area exhibit a multi-layered vertical structure. While the average tree age is around 80 years, most of the forest area (20\%) is occupied by trees between 40 and 60 years of age, whereas 27\% of the trees are older than 100 years. Spatially variable climate conditions have a strong influence on the local growth dynamics as well as tree species composition and create a large variety of forest structures, ranging from characteristic oak coppices (Moselle valley), pure spruce, beech and scots pine forests (e.g. Hunsr{\"u}ck and Palatinate forest) to mixed forests comprising variable proportions of oak, larch, spruce, Scots pine and beech. Accordingly, RLP has been divided into 16 bioclimatic growing regions that form homogeneous areas with respect to the afore mentioned characteristics \citep{gauer2005}.

\begin{figure}[h]
\centering
\resizebox{1\hsize}{!}{\includegraphics*{terr_sampledesign_bw.png}}
\caption{Spatial distribution of the \bwi{} cluster samples over Rhineland-Palatinate}
\label{fig:Study Area}
\end{figure}

% ----------------------------------------------------------------------- %
% ----------------------------------------------------------------------- %
\subsection{Terrestrial Inventory Data}
\label{sec:terrdata}
The German National Forest Inventory is carried out over the entire forest area of Germany in reoccurring time periods of 10 years. The most recent inventory (\bwi{}) has been conducted in the years 2011 and 2012. In this framework, Rhineland-Palatinate is covered by a 2x2 km grid that defines the sample locations for the terrestrial survey. A sample unit consists of four sample locations (also referred to as \textit{sample plots}) that are arranged in squares (so called \textit{clusters}) with a side length of 150 metres (figure \ref{fig:Study Area}). The number of plots per cluster can however vary between 1 and 4 depending on forest/non-forest decisions on the plot level \citep{bwi3_aufn}. In the field survey of the \bwi{}, sample trees for timber volume estimations are selected according to the angle count sampling technique \citep{bitterlich1984}, using a basal area factor ($BAF$) of 4 that is respectively adjusted for boundary effects at the forest border \citep{bwi3_aufn}. A further selection criterion for a tree to be recorded is a diameter at breast height ($dbh$) of at least 7 cm. \added{This sampling technique was applied to 8092 sample plots (2810 clusters) in RLP, resulting in the collection of 56561 sample trees for which the dbh, the tree diameter at 7 m ($D7$) and the tree species were recorded for all trees. Tree height measurements were conducted only for a subset of all sample trees and used to predict the height for the remaining sample. During the last inventory, all plot center positions were remeasured with a differential GPS technique. Knowledge about the exact plot positions were considered crucial to provide optimal comparability between the terrestrially observations and the information derived from the auxiliary information. A detailed analysis of horizontal DGPS errors in RLP by \citet{lambrecht2017} indicated that horizontal DGPS errors do not exceed a range of 8 meters for 80\% of all plots. For 162 plots, the DGPS coordinates were replaced by their former target coordinates due to missing or implausible values.} In order to derive a volume estimation for each sample tree, the \bwi{} estimates a taper curve for each sample tree by calibrating the random effects term of linear mixed-effects taper models with the set of diameters and corresponding height measurements taken from the respective sample tree \citep{kublin2013}. The integration of the derived taper curves consequently lead to a volume prediction for each sample tree. \changed{Since the overall objective of the study was to subsequently use the identified regression model for design-based timber volume estimations within the state and communal forest management units, we already restricted the sample plots used for modeling to the state and communal forest area (73\% of the entire forest area of RLP). This provides the advantage that when used as an internal model in design-based estimators, the regression model predictions already hold the assumption on the residuals to be zero on average for state and communal forest by construction of OLS technique \citep{mandallaz2013a, mandallaz2013b, mandallaz2013c}.} The dataset of this study hence comprised 5791 plots (2055 clusters). For this sample, the timber volume density per hectare on plot level, $Y(x)$, was calculated according to the formula of one-phase one-stage sampling \citep{mandallaz2008}. The timber volume density per hectare on plot level was used as the response variable in the regression analysis.


% ----------------------------------------------------------------------- %
% ----------------------------------------------------------------------- %
\subsection{Auxiliary Information}
\label{sec:auxinfo}

% ----------------------------------------------------------- %
\subsubsection{LiDAR Canopy Height Model}
\label{sec:chm}

Between 2003 and 2013, the topographic survey institution of RLP acquired airborne laser scanning (LiDAR) data over the entire state of RLP at leaf-off condition (Figure \ref{abb:lidaryears}). The objective of this campaign was to derive a countrywide digital terrain and surface model based on the acquired LiDAR point clouds. During the extended acquisition period, airborne laser scanning technology and data quality evolved significantly. The tiles recorded in 2002 and 2003 have a rather poor quality with about only 1 point per 5x5 m$^2$, while more recently acquired datasets contain more than 125 points per 5x5 m$^2$ raster cell. The data was delivered as two separate point clouds: one cloud contained filtered ground returns, whereas the other cloud contained first pulses from non-ground objects. All point clouds were delivered as three-column (easting, northing, and height above sea level) ASCII files in tiles of 1 km$^2$. Before interpolating the point clouds to regular rasters, the clouds were thinned. For the ground data, the mean value of each raster cell in the final resolution of 5x5 m$^2$ was calculated. For the surface model, both ground and vegetation point clouds were first united, and the maximum value for each raster cell was determined respectively. The combination of both point clouds was necessary in order to avoid large spaces without laser points between vegetated areas that would otherwise have been filled with unrealistic values in the interpolation step. The thinned point clouds were aggregated to larger tiles in order to decrease the number of seamlines in the final mosaic. The aggregated tiles were then interpolated to raster images using a Delauney interpolation in the Matlab software \citep{matlab}. The resulting two elevation models were then used to calculate a canopy height model (\textit{CHM}) in raster format, providing discrete information about the canopy surface height of the forest area in a spatial resolution of 5 meters.\par 
As explanatory variables, the mean canopy height (\textit{meanheight}) and the standard deviation ($stddev$) were calculated as the mean and standard deviation of all raster values within a predefined square around each sample plot center. The square (i.e. \textit{support} of the explanatory variable, see section \ref{sec:supp}) was previously intersected with the state and communal forest area defined by a polygon mask and thereby corrected for edge effects at the forest border. The tree height is one prominent predictor variable in the taper functions of the \bwi{} that are used to calculate a timber volume value for each sample tree \citep{kublin2003, kublin2013}. A visual inspection of the tree volumes of all sample trees collected in the \bwi{} within RLP against their tree heights also revealed the characteristic shape of an allometric relationship between these variables (Online Resource 1). It was hypothesized that this relationship on single-tree level is also apparent on the aggregated level of a sample plot and cluster, and can be used within the frame of regression modeling.\par
The strength of correlation between \textit{meanheight} and timber volume on plot level was expected to show high variation according to the mentioned time-lag up to 10 years between LiDAR acquisition and terrestrial survey. The quality of the height information was also expected to vary according to changing sensor technologies and different point densities used over the years. For these reasons, the LiDAR acquisition year (\textit{lidaryear}) for each sample plot was considered as a potential categorical explanatory variable to explain the variation in the data introduced by these factors. For this purpose, the acquisition year \textit{2008} was further divided into \textit{2008} and \textit{2008\_1}. In the latter, the data quality turned out to be very poor due to sensor failures during the acquisition. Additionally, the years \textit{2006} and \textit{2007} as well as \textit{2012} and \textit{2013} were pooled in order to increase the number of observations per factor level for modelling reasons. As a result, the \textit{lidaryear} variable comprised nine categories (\textit{2002}, \textit{2003}, \textit{2007}, \textit{2008}, \textit{2008\_1}, \textit{2009}, \textit{2010}, \textit{2011} and \textit{2012}).

\begin{figure}[H]
\centering
\resizebox{0.7\hsize}{!}{\includegraphics*{lidar_years_quality.png}}
\caption{Separate LiDAR acquisitions in Rhineland-Palatinate over the years. The colors also indicate the quality of the data: \textit{light}: low point densities (1/5x5$m^2$), \textit{dark}: high point densities ($>$100/5x5$m^2$)}
\label{abb:lidaryears}
\end{figure}


% ----------------------------------------------------------- %
\subsubsection{Tree Species Classification Map}
\label{sec:tspecclass}

A countrywide satellite-based classification map of the five main tree species (European beech, Sessile and Pedunculate oak, Norway spruce, Douglas fir, Scots pine) described in \citet{stoffels2015} was used to derive tree species information on sample plot level. The classified tree species map has a grid size of 5 meters and predicts five of the seven tree species that are used in the \bwi{} taper functions \citep{kublin2013} to calculate the timber volume of a sample tree. Due to unavailable satellite data for the classification, the tree species map excluded one patch with an area of 415 km$^2$ in the south-west part of RLP, and two further patches with an area of 76 km$^2$ and 100 km$^2$ in the northern part \citep{stoffels2015}. The tree species information was consequently missing for 407 (7\%) of the 5791 sample locations.

\subsubsection*{Prediction of main plot tree species}

A visual inspection of all \bwi{} sample trees of RLP suggested that a stratification of the relation between tree height and timber volume according to these seven tree species may provide a considerable reduction in variation within the tree species groups (Online Resource 1). This led to the hypothesis that this tree species specific signal might also be apparent on sample plot and cluster level and can consequently be used to increase the accuracy of the prediction model. Based on the tree species classification map, the main tree species of each sample plot was calculated as an additional categorical explanatory variable ($treespecies$) with six categories following a similar approach as \citet{latifi2012}: one of the five tree species was assigned as the main plot tree species if its proportion within the edge-corrected support around the sample location exceeded a predefined threshold. If this threshold was not reached by any of the five tree species, the respective sample plot was assigned the category 'Mixed'.\par


\subsubsection*{Calibration}

Our analyses revealed that the prediction of the main tree species for a sample plot can be subject to misclassifications (section \ref{sec:supp_tspec_res}). Errors in the explanatory variables of linear regression models can however lead to a bias of the regression coefficients in the direction of zero due to an artificial introduction of noise \citep{carroll2006}. This can cause an inflation of the residual variance and a consequent decrease of the model accuracy \citep{magnussen2010}. In case of classification the impacts of misclassifications on the model properties are even harder to predict \citep{gustafson2003}. While errors in the explanatory variables do not affect the unbiasedness of the estimators in the model-assisted framework, a reduction or elimination of the classification errors could provide an improvement of the regression model accuracy and thereby potentially lead to smaller prediction and estimation errors. We therefore addressed the effect of misclassifications in the \textit{treespecies} variable by the following analysis:

\renewcommand{\labelenumi}{\alph{enumi})}
\begin{enumerate}

\item {we investigated the effect on the regression model performance (regression coefficients, model accuracy) when substituting the  
$predicted$ by the $actual$ main plot tree species derived from the sampled trees of the respective sample plot under identical threshold settings}

\item {we used the random forest algorithm \citep{liaw2002, breiman2001} in the statistical software $R$ \citep{R} to define a \textit{calibration model} in order to improve the classification accuracy of the initially predicted main plot tree species, correct for potential systematic misclassifications and thus minimize the effect of misclassifications on the regression model. The random forest algorithm is a machine learning algorithm that grows a large number of decorrelated classification trees by considering only a subset of all provided predictor variables for each split. In the case of classification, new data are thus predicted by aggregating the predictions of all trees using a majority vote. For our purpose of predicting the actual main tree species of a sample plot (target variable), we provided the random forest algorithm with a full set of $p$ predictor variables that comprised the initial prediction of the main plot tree species (\textit{treespecies}), the mean canopy height (\textit{meanheight}) and standard deviation ($stddev$) derived from the CHM, the proportion of coniferous trees estimated from the tree species classification map ($prop.conif$) and the bioclimatic growing region ($wgb$) at the sample location. The algorithm was grown with 2000 trees, considering $\sqrt{p} \approx$ 3 of the predictors for each split.}

\end{enumerate}

% ----------------------------------------------------------------------- %
% ----------------------------------------------------------------------- 
\subsection{Choice of Support under Angle Count Sampling}
\label{sec:supp}

One characteristic of angle count sampling applied in the \bwi{} is that a sample plot does not have a fixed radius in which trees are selected (\textit{fixed-radius plot}), but each tree generates an individual radius from the plot center depending on its diameter at breast height (\textit{variable-radius plot}). This tree-individual radius is known as the \textit{limiting distance} from the plot center where the tree would still be included in the sample. A consequence of the absence of a fixed plot radius is the question about the optimal support \citep{hollaus2007}, i.e. the spatial extent around the plot center in which the auxiliary information is evaluated and transformed into an explanatory variable. It has widely been hypothesized that the best relationship between the target variable on the ground and any explanatory variable derived from the auxiliary information is obtained if the support is spatially identical to the sample plot extent. In case of angle count sampling, an individual extent for each sample plot can be approximated by regarding the maximum limiting distances of its sample trees as the outer plot radius. However, many model-assisted applications under double-sampling do not allow for a between-plot change of the support for a specific explanatory variable \citep{mandallaz2013c, mandallaz2013a}.\par
For this reason, the task is to find a unique support for each auxiliary information that leads to the best overall model accuracy. \citet{deo2016} conducted extensive analysis to identify optimal supports for modelling standing timber volume for \textit{variable-radius plot} designs in conifer forests. They analysed 24 different radii (i.e. circular supports) in which they extracted 57 metrics from a LiDAR derived point cloud with an average point density of 18 pulses per square meter. They successively evaluated the prediction performance of each support size by using the LiDAR metrics in a random forest algorithm and comparing the resulting model accuracies. In order to identify the best-performing supports for our explanatory variables, we followed a similar approach. The explanatory variables were calculated using $individual$ (i.e. plot-varying) supports ($ind$), i.e. an individual support extent was used for each plot according to the maximum limiting distance of all sample trees associated to the respective sample plot. We then compared the model accuracies achieved by the individual supports against the model accuracies from a set of $fixed$ (i.e. non plot-varying) supports. The extents of the fixed supports were chosen from the cumulative distribution function (ECDF) of the maximum limiting distances of all 5791 sample plots of the analysed forest area (Fig. \ref{fig:sf1}). We considered the $25^{th}$ ($q25$, 9 meters), $50^{th}$ ($q50$, 12 meters), $80^{th}$ ($q80$, 15 meters) and the $100^{th}$ ($q100$, 38 meters) percentiles, resulting in support side lengths of 18, 24, 30 and 76 meters (Fig. \ref{fig:tspec_supps}). While in this study we used squares to extract the auxiliary information, also other support-shapes are possible (e.g. circles, hexagons). We also want to emphasize that the use of different support sizes for each explanatory variable is perfectly valid in the infinite population framework of model-assisted estimators \citep{mandallaz2013c, mandallaz2013a}.

\begin{figure}[h]
\centering
\subcaptionbox{ECDF of maximum limiting distances of all \bwi{} sample locations in RLP \label{fig:sf1}}{
  \includegraphics[width=0.35\textwidth]{cdf_maxri.png}%
  }\par\medskip
\subcaptionbox{Rectangular supports used to extract explanatory variables around sample locations. \textit{Dash dot dot line}: q100, \textit{dash dot line}: q80, \textit{dot dot line}: q50, \textit{dot line}: q25, \textit{solid line}: individual support, \textit{triangles}: sample trees \label{fig:sf2}}{
  \includegraphics[width=0.32\textwidth]{choice_of_support.png}
  }\par\medskip
\caption{Identification (\textit{a)}) and visualization (\textit{b)}) of potential supports used for calculating the predictor variables on plot level}
\label{fig:tspec_supps}
\end{figure}


% ----------------------------------------------------------------------- %
% ----------------------------------------------------------------------- %
\subsection{Model Validation}
\label{sec:modval}

In order to judge the quality of the \textit{treespecies} variable, the user's accuracy for each classified species and the overall accuracy of the classification scheme was calculated based on the confusion matrix \citep{congalton2008}, using the main plot tree species calculated from the sample trees as reference data. The classification accuracy was performed for all support sizes for both the calibrated and the uncalibrated \textit{treespecies} variables. The measures of the regression model accuracy using both CHM- and $treespecies$ variables were defined as the 10-fold cross-validated root mean square error (\rmsecv{}) and the adjusted coefficient of determination (\adjrsq{}) of the multiple linear regression model defined in equation \ref{eq:chmtspec_fullmod_term}. Additionally, we considered the interaction terms \textit{meanheight}:\textit{treespecies}, \textit{meanheight$^{2}$:treespecies}, \textit{meanheight}:\textit{lidaryear}, \textit{stddev}:\textit{lidaryear} and \textit{meanheight}:\textit{stddev} and performed a variable selection based on the Akaike Information Criterion (AIC) \citep{Akaike2011} in order to minimize the number of variables in the model. Due to a pronounced unbalanced design in the \textit{treespecies}-\textit{lidaryear} strata (Online Resource 2), no interaction between \textit{treespecies} and \textit{lidaryear} was possible. We evaluated the model for all support combinations, considering the use of individual support sizes for each auxiliary information, using both the calibrated and the uncalibrated \textit{treespecies} variable. The calibration model (section \ref{sec:tspecclass}) for the \textit{treespecies} variable was recalculated for each respective support-threshold setting.

\begin{equation} \label{eq:chmtspec_fullmod_term}
  \begin{split}
     Y(x) = &\beta_{0} + \beta_{1}*meanheight + \beta_{2}*meanheight^{2} + \\ 
            &\beta_{3}*stddev + \\
            &\beta_{4}*lidaryear_1 + ... + \beta_{12}*lidaryear_9 + \\
            &\beta_{13}*treespecies_1 + ... + \beta_{18}*treespecies_6 + e(x)
  \end{split}
\end{equation}

206 sample plots included no sample trees and the timber volume density $Y(x)$ was thus set to \textit{zero}. These \textit{zero-plots} were removed from the modeling dataset since they acted as leverage points in cases where the LiDAR height metrics were recorded long before the terrestrial survey. Together with the missing tree species information (section \ref{sec:tspecclass}), the modeling dataset was limited to 5206 observations.